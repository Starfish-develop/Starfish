

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Grid Tools &mdash; Starfish 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Starfish 0.1 documentation" href="index.html"/>
        <link rel="next" title="Spectrum" href="spectrum.html"/>
        <link rel="prev" title="Overview" href="overview.html"/>
 

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5472810-5', 'auto');
  ga('send', 'pageview');

</script>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> Starfish</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#obtaining-model-spectra">Obtaining model spectra</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#the-spectral-emulator">The Spectral Emulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#spectrum-data-formats-and-runtime">Spectrum data formats and runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#the-mcmc-driver-script">The MCMC driver script</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#memory-usage">Memory usage</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Grid Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#downloading-model-spectra">Downloading model spectra</a></li>
<li class="toctree-l2"><a class="reference internal" href="#raw-grid-interfaces">Raw Grid Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hdf5-creators-and-fast-interfaces">HDF5 creators and Fast interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interpolators">Interpolators</a></li>
<li class="toctree-l2"><a class="reference internal" href="#instruments">Instruments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#utility-functions">Utility Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exceptions">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spectrum.html">Spectrum</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spectrum.html#log-lambda-spacing">Log lambda spacing</a></li>
<li class="toctree-l2"><a class="reference internal" href="spectrum.html#data-spectrum">Data Spectrum</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="emulator.html">Spectral Emulator</a><ul>
<li class="toctree-l2"><a class="reference internal" href="emulator.html#eigenspectra-decomposition">Eigenspectra decomposition</a></li>
<li class="toctree-l2"><a class="reference internal" href="emulator.html#optimizing-the-emulator">Optimizing the emulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="emulator.html#model-spectrum-reconstruction">Model spectrum reconstruction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="MCMC.html">MCMC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="MCMC.html#creating-the-parameter-script">Creating the parameter script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scripts.html#hdf5-scripts">HDF5 Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripts.html#plotting-scripts">Plotting Scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">Cookbook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cookbook.html#using-the-linear-interpolator">Using the linear interpolator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_wasp14.html">Example: WASP 14</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14.html#preamble">Preamble</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14.html#just-getting-set-up">Just getting set up.</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14.html#generating-the-eigenspectra-and-their-weights">Generating the eigenspectra and their weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14.html#using-the-linear-interpolator">Using the linear interpolator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_wasp14_data.html">Example: WASP 14 Data Munging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_data.html#preamble">Preamble</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_data.html#set-up-the-calibration-parameters">Set up the calibration parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_data.html#spot-check-your-data-and-model-parameters">Spot check your data and model parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_wasp14_sampling.html">Example: WASP 14 Sampling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_sampling.html#preamble">Preamble</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_sampling.html#optimize">Optimize</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_sampling.html#setting-up-an-mcmc-run">Setting up an MCMC run</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_sampling.html#running-mcmc">Running MCMC</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_sampling.html#sample-with-the-covariance-kernels">Sample with the covariance kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_sampling.html#generate-local-kernels">Generate local kernels</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example_wasp14_multi.html">Example: WASP 14 Multiple Orders</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_multi.html#getting-set-up">Getting set up</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_multi.html#only-spot-check-the-last-order"># Only spot check the last order</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_wasp14_multi.html#mcmc"># MCMC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#problems-generating-model-bad-wavelength-range">Problems generating model: Bad wavelength range</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#nonetype-and-parameters-out-of-range">NoneType and parameters out of range</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html#fix-c0-is-incorrectly-disabled"><cite>fix_c0</cite> is incorrectly disabled</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tips_and_tricks.html">Tips and Tricks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tips_and_tricks.html#time-how-long-it-takes-your-script-to-run">Time how long it takes your script to run.</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips_and_tricks.html#tuning-the-mcmc-jump-sizes">Tuning the MCMC jump sizes</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips_and_tricks.html#how-many-cpus-do-you-have">How many CPUs do you have.</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Starfish</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Grid Tools</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/grid_tools.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="module-Starfish.grid_tools">
<span id="grid-tools"></span><h1><a class="toc-backref" href="#id1">Grid Tools</a><a class="headerlink" href="#module-Starfish.grid_tools" title="Permalink to this headline">¶</a></h1>
<p><code class="xref py py-mod docutils literal"><span class="pre">grid_tools</span></code> is a module to interface with and manipulate libraries of synthetic spectra.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#module-Starfish.grid_tools" id="id1">Grid Tools</a><ul>
<li><a class="reference internal" href="#downloading-model-spectra" id="id2">Downloading model spectra</a></li>
<li><a class="reference internal" href="#raw-grid-interfaces" id="id3">Raw Grid Interfaces</a></li>
<li><a class="reference internal" href="#hdf5-creators-and-fast-interfaces" id="id4">HDF5 creators and Fast interfaces</a></li>
<li><a class="reference internal" href="#interpolators" id="id5">Interpolators</a></li>
<li><a class="reference internal" href="#instruments" id="id6">Instruments</a></li>
<li><a class="reference internal" href="#utility-functions" id="id7">Utility Functions</a></li>
<li><a class="reference internal" href="#exceptions" id="id8">Exceptions</a></li>
</ul>
</li>
</ul>
</div>
<p>It defines many useful functions and objects that may be used in the modeling package <code class="xref py py-mod docutils literal"><span class="pre">model</span></code>, such as <code class="xref py py-obj docutils literal"><span class="pre">Interpolator</span></code>.</p>
<div class="section" id="downloading-model-spectra">
<h2><a class="toc-backref" href="#id2">Downloading model spectra</a><a class="headerlink" href="#downloading-model-spectra" title="Permalink to this headline">¶</a></h2>
<p>Before you may begin any fitting, you must acquire a synthetic library of model spectra. If you will be fitting spectra of stars, there are many high quality synthetic and empirical spectral libraries available. In our paper, we use the freely available PHOENIX library synthesized by T.O. Husser. The library is available for download here: <a class="reference external" href="http://phoenix.astro.physik.uni-goettingen.de/">http://phoenix.astro.physik.uni-goettingen.de/</a></p>
<p>Because spectral libraries are generally large (&gt; 10 Gb), please make sure you available disk space before beginning the download. Downloads may take a day or longer, so it is recommended to start the download ASAP.</p>
<p>You may store the spectra on disk in whatever directory structure you find convenient, provided you adjust the Starfish routines that read spectra from disk. To use the default settings for the PHOENIX grid, please create a <code class="docutils literal"><span class="pre">libraries</span></code> directory, a <code class="docutils literal"><span class="pre">raw</span></code> directory within <code class="docutils literal"><span class="pre">libraries</span></code>, and unpack the spectra in this format:</p>
<div class="highlight-python"><div class="highlight"><pre>libraries/raw/
    PHOENIX/
        WAVE_PHOENIX-ACES-AGSS-COND-2011.fits
        Z+1.0/
        Z-0.0/
        Z-0.0.Alpha=+0.20/
        Z-0.0.Alpha=+0.40/
        Z-0.0.Alpha=+0.60/
        Z-0.0.Alpha=+0.80/
        Z-0.0.Alpha=-0.20/
        Z-0.5/
        Z-0.5.Alpha=+0.20/
        Z-0.5.Alpha=+0.40/
        Z-0.5.Alpha=+0.60/
        Z-0.5.Alpha=+0.80/
        Z-0.5.Alpha=-0.20/
        Z-1.0/
</pre></div>
</div>
</div>
<div class="section" id="raw-grid-interfaces">
<span id="grid-reference-label"></span><h2><a class="toc-backref" href="#id3">Raw Grid Interfaces</a><a class="headerlink" href="#raw-grid-interfaces" title="Permalink to this headline">¶</a></h2>
<p><em>Grid interfaces</em> are classes designed to abstract the interaction with the raw synthetic stellar libraries under a common interface. The <code class="xref py py-obj docutils literal"><span class="pre">RawGridInterface</span></code> class is designed to be extended by the user to provide access to any new grids. Currently there are extensions for three main grids:</p>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference external" href="http://phoenix.astro.physik.uni-goettingen.de/">PHOENIX spectra</a> by T.O. Husser et al 2013</li>
<li>Kurucz spectra by Laird and Morse (available to CfA internal only)</li>
<li><a class="reference external" href="http://phoenix.ens-lyon.fr/Grids/BT-Settl/">PHOENIX BT-Settl</a> spectra by France Allard</li>
</ol>
</div></blockquote>
<p>There are two interfaces provided to the PHOENIX/Husser grid: one that includes alpha enhancement and another which restricts access to 0 alpha enhancement.</p>
<p>Here and throughout the code, stellar spectra are referenced by a numpy array of parameter values, which corresponds to the parameters listed in the config file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6000</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
</pre></div>
</div>
<p>Here we introduce the classes and their methods. Below is an example of how you might use the <code class="xref py py-obj docutils literal"><span class="pre">PHOENIXGridInterface</span></code>.</p>
<p>In order to load a raw file from the PHOENIX grid, one would do</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># if you downloaded the libraries elsewhere, be sure to include base=&quot;mydir&quot;</span>
<span class="kn">import</span> <span class="nn">Starfish</span>
<span class="kn">from</span> <span class="nn">Starfish.grid_tools</span> <span class="kn">import</span> <span class="n">PHOENIXGridInterfaceNoAlpha</span> <span class="k">as</span> <span class="n">PHOENIX</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">mygrid</span> <span class="o">=</span> <span class="n">PHOENIX</span><span class="p">()</span>
<span class="n">my_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6000</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="n">flux</span><span class="p">,</span> <span class="n">hdr</span> <span class="o">=</span> <span class="n">mygrid</span><span class="o">.</span><span class="n">load_flux</span><span class="p">(</span><span class="n">my_params</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">flux</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
<span class="n">array</span><span class="p">([</span> <span class="mf">4679672.5</span>       <span class="p">,</span>  <span class="mf">4595894.</span>        <span class="p">,</span>  <span class="mf">4203616.5</span>       <span class="p">,</span> <span class="o">...</span><span class="p">,</span>
          <span class="mf">11033.5625</span>    <span class="p">,</span>    <span class="mf">11301.25585938</span><span class="p">,</span>    <span class="mf">11383.8828125</span> <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">hdr</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span>
<span class="p">{</span><span class="s">&#39;PHXDUST&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s">&#39;PHXLUM&#39;</span><span class="p">:</span> <span class="mf">5.0287e+34</span><span class="p">,</span>
 <span class="s">&#39;PHXVER&#39;</span><span class="p">:</span> <span class="s">&#39;16.01.00B&#39;</span><span class="p">,</span>
 <span class="s">&#39;PHXREFF&#39;</span><span class="p">:</span> <span class="mf">233350000000.0</span><span class="p">,</span>
 <span class="s">&#39;PHXEOS&#39;</span><span class="p">:</span> <span class="s">&#39;ACES&#39;</span><span class="p">,</span>
 <span class="s">&#39;PHXALPHA&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s">&#39;PHXLOGG&#39;</span><span class="p">:</span> <span class="mf">3.5</span><span class="p">,</span>
 <span class="s">&#39;PHXTEFF&#39;</span><span class="p">:</span> <span class="mf">6000.0</span><span class="p">,</span>
 <span class="s">&#39;PHXMASS&#39;</span><span class="p">:</span> <span class="mf">2.5808e+33</span><span class="p">,</span>
 <span class="s">&#39;PHXXI_N&#39;</span><span class="p">:</span> <span class="mf">1.49</span><span class="p">,</span>
 <span class="s">&#39;PHXXI_M&#39;</span><span class="p">:</span> <span class="mf">1.49</span><span class="p">,</span>
 <span class="s">&#39;PHXXI_L&#39;</span><span class="p">:</span> <span class="mf">1.49</span><span class="p">,</span>
 <span class="s">&#39;PHXMXLEN&#39;</span><span class="p">:</span> <span class="mf">1.48701064748</span><span class="p">,</span>
 <span class="s">&#39;PHXM_H&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
 <span class="s">&#39;PHXBUILD&#39;</span><span class="p">:</span> <span class="s">&#39;02/Aug/2010&#39;</span><span class="p">,</span>
 <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
 <span class="s">&#39;air&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">mygrid</span><span class="o">.</span><span class="n">wl</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
<span class="n">array</span><span class="p">([</span>  <span class="mf">3000.00133087</span><span class="p">,</span>   <span class="mf">3000.00732938</span><span class="p">,</span>   <span class="mf">3000.01332789</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>
        <span class="mf">53999.27587687</span><span class="p">,</span>  <span class="mf">53999.52580875</span><span class="p">,</span>  <span class="mf">53999.77574063</span><span class="p">])</span>
</pre></div>
</div>
<div class="section" id="creating-your-own-interface">
<h3>Creating your own interface<a class="headerlink" href="#creating-your-own-interface" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-obj docutils literal"><span class="pre">RawGridInterface</span></code> and subclasses exist solely to interface with the raw files on disk. At minimum, they should each define a <code class="xref py py-meth docutils literal"><span class="pre">load_flux()</span></code> , which takes in a dictionary of parameters and returns a flux array and a dictionary of whatever information may be contained in the file header.</p>
<p>Under the hood, each of these is implemented differently depending on how the synthetic grid is created. In the case of the BTSettl grid, each file in the grid may actually have a flux array that has been sampled at separate wavelengths. Therefore, it is necessary to actually interpolate each spectrum to a new, common grid, since the wavelength axis of each spectrum is not always the same. Depending on your spectral library, you may need to do something similar.</p>
</div>
</div>
<div class="section" id="hdf5-creators-and-fast-interfaces">
<h2><a class="toc-backref" href="#id4">HDF5 creators and Fast interfaces</a><a class="headerlink" href="#hdf5-creators-and-fast-interfaces" title="Permalink to this headline">¶</a></h2>
<p>While using the <a class="reference internal" href="#grid-reference-label"><span>Raw Grid Interfaces</span></a> may be useful for ordinary spectral reading, for fast read/write it is best to use HDF5 files to store only the data you need in a hierarchical binary data format. Let&#8217;s be honest, we don&#8217;t have all the time in the world to wait around for slow computations that carry around too much data. Before introducing the various ways to compress the spectral library, it might be worthwhile to review the section of the <a class="reference internal" href="spectrum.html"><em>Spectrum</em></a> documentation that discusses how spectra are sampled and resampled in log-linear coordinates.</p>
<p>If we will be fitting a star, there are generally three types of optimizations we can do to the spectral library to speed computation.</p>
<ol class="arabic simple">
<li>Use only a range of spectra that span the likely parameter space of your star. For example, if we know we have an F5 star, maybe we will only use spectra that have <span class="math">\(5900~\textrm{K} \leq T_\textrm{eff} \leq 6500~\textrm{K}\)</span>.</li>
<li>Use only the part of the spectrum that overlaps your instrument&#8217;s wavelength coverage. For example, if the range of our spectrograph is 4000 - 9000 angstroms, it makes sense to discard the UV and IR portions of the synthetic spectrum.</li>
<li>Resample the high resolution spectra to a lower resolution more suitably matched to the resolution of your spectrograph. For example, PHOENIX spectra are provided at <span class="math">\(R \sim 500,000\)</span>, while the TRES spectrograph has a resolution of <span class="math">\(R \sim 44,000\)</span>.</li>
</ol>
<p>All of these reductions can be achieved using the <code class="xref py py-obj docutils literal"><span class="pre">HDF5Creator</span></code> object.</p>
<p>Here is an example using the <code class="xref py py-obj docutils literal"><span class="pre">HDF5Creator</span></code> to transform the raw spectral library into an HDF5 file with spectra that have the resolution of the <em>TRES</em> instrument.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">Starfish</span>
<span class="kn">from</span> <span class="nn">Starfish.grid_tools</span> <span class="kn">import</span> <span class="n">PHOENIXGridInterfaceNoAlpha</span> <span class="k">as</span> <span class="n">PHOENIX</span>
<span class="kn">from</span> <span class="nn">Starfish.grid_tools</span> <span class="kn">import</span> <span class="n">HDF5Creator</span><span class="p">,</span> <span class="n">TRES</span>


<span class="n">mygrid</span> <span class="o">=</span> <span class="n">PHOENIX</span><span class="p">()</span>
<span class="n">instrument</span> <span class="o">=</span> <span class="n">TRES</span><span class="p">()</span>

<span class="n">creator</span> <span class="o">=</span> <span class="n">HDF5Creator</span><span class="p">(</span><span class="n">mygrid</span><span class="p">,</span> <span class="n">Starfish</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s">&quot;hdf5_path&quot;</span><span class="p">],</span> <span class="n">instrument</span><span class="p">,</span>
<span class="n">ranges</span><span class="o">=</span><span class="n">Starfish</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="s">&quot;parrange&quot;</span><span class="p">])</span>

<span class="n">creator</span><span class="o">.</span><span class="n">process_grid</span><span class="p">()</span>
</pre></div>
</div>
<p>Once you&#8217;ve made a grid, then you&#8217;ll want to interface with it via <code class="xref py py-obj docutils literal"><span class="pre">HDF5Interface</span></code>. The <code class="xref py py-obj docutils literal"><span class="pre">HDF5Interface</span></code> provides <cite>load_file</cite>  similar to that of the raw grid interfaces. It does not make any assumptions about how what resolution the spectra are stored, other than that the all spectra within the same HDF5 file share the same wavelength grid, which is stored in the HDF5 file as &#8216;wl&#8217;. The flux files are stored within the HDF5 file, in a subfile called &#8216;flux&#8217;.</p>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>For example, to load a file from our recently-created HDF5 grid</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">Starfish</span>
<span class="kn">from</span> <span class="nn">Starfish.grid_tools</span> <span class="kn">import</span> <span class="n">HDF5Interface</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">myHDF5</span> <span class="o">=</span> <span class="n">HDF5Interface</span><span class="p">()</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">myHDF5</span><span class="o">.</span><span class="n">load_flux</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6100</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">flux</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
<span class="n">array</span><span class="p">([</span> <span class="mf">10249189.</span><span class="p">,</span>  <span class="mf">10543461.</span><span class="p">,</span>  <span class="mf">10742093.</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>   <span class="mf">9639472.</span><span class="p">,</span>   <span class="mf">9868226.</span><span class="p">,</span>
    <span class="mf">10169717.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">float32</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="interpolators">
<h2><a class="toc-backref" href="#id5">Interpolators</a><a class="headerlink" href="#interpolators" title="Permalink to this headline">¶</a></h2>
<p>The interpolators are used to create spectra in between grid points, for example
<code class="docutils literal"><span class="pre">myParams</span> <span class="pre">=</span> <span class="pre">{&quot;temp&quot;:6114,</span> <span class="pre">&quot;logg&quot;:4.34,</span> <span class="pre">&quot;Z&quot;:</span> <span class="pre">0.12,</span> <span class="pre">&quot;alpha&quot;:0.1}</span></code>. Note, this currently broken and will remain so unless there is a good use case. For now, it is recommended to use the <a class="reference internal" href="emulator.html"><em>Spectral Emulator</em></a>.</p>
<p>For example, if we would like to generate a spectrum with the aforementioned parameters, we would do</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">myInterpolator</span> <span class="o">=</span> <span class="n">Interpolator</span><span class="p">(</span><span class="n">myHDF5</span><span class="p">)</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">myInterpolator</span><span class="p">({</span><span class="s">&quot;temp&quot;</span><span class="p">:</span><span class="mi">6114</span><span class="p">,</span> <span class="s">&quot;logg&quot;</span><span class="p">:</span><span class="mf">4.34</span><span class="p">,</span> <span class="s">&quot;Z&quot;</span><span class="p">:</span> <span class="mf">0.12</span><span class="p">,</span> <span class="s">&quot;alpha&quot;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="instruments">
<h2><a class="toc-backref" href="#id6">Instruments</a><a class="headerlink" href="#instruments" title="Permalink to this headline">¶</a></h2>
<p>In order to take the theoretical synthetic stellar spectra and make meaningful comparisons to actual data, we need to convolve and resample the synthetic spectra to match the format of our data. <code class="docutils literal"><span class="pre">Instrument</span></code> s are a convenience object which store the relevant characteristics of a given instrument.</p>
<p>A wl_dict that fits the instrumental properties with the correct oversampling.</p>
</div>
<div class="section" id="utility-functions">
<h2><a class="toc-backref" href="#id7">Utility Functions</a><a class="headerlink" href="#utility-functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="wavelength-conversions">
<h3>Wavelength conversions<a class="headerlink" href="#wavelength-conversions" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="exceptions">
<h2><a class="toc-backref" href="#id8">Exceptions</a><a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h2>
<p>These exceptions will be called if anything is amiss.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="spectrum.html" class="btn btn-neutral float-right" title="Spectrum">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral" title="Overview"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-15, Ian Czekala.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>